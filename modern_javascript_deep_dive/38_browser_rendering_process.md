# 38장 브라우저 랜더링 과정

<details>

<summary> 1. 브라우저 렌더링 과정은 어떻게 되나요?  </summary>

```
브라우저 렌더링은 화면에 그려줄 리소스들을 서버에 요청해서, 응답받은 리소스들을 파싱하고 렌더링하고 페인트하는 과정입니다.
브라우저 검색창에 먼저 URL을 입력하면 DNS을 통해 IP주소로 변환되고, 이 IP주소로 서버에게 요청을 합니다.
브라우저는 바이트로 된 html문서를 meta 태그의 charset attribute에 의해 문자열로 인코딩합니다.

문자열로 변환된 html 문서를 읽으면서 토큰 (문법적 의미를 갖는 코드의 최소 단위)로 분해합니다.
각 토큰들을 객체로 변환하여 문서노드, 요소노드 attribute노드, 텍스트 노드 등. 노드들을 생성하며,
이 노드들을 트리 형태로 구성한 DOM을 생성합니다.

DOM 생성 중간 CSS로드 link 태그나 style 태그를 만나면 일시 중단하고
CSS 파일을 서버에 요청하여 로드한 CSS 파일이나 style 태그 내의 CSS를 파싱합니다.
DOM과 동일한 과정으로 바이트로 된 파일을 문자로 변환하고, 문자들을 토큰으로 분해한 뒤, 노드를 생성하여 CSSOM을 생성합니다.
CSS 파싱이 완료됩면 HTML 파싱을 중닫했던 곳에서 DOM 생성을 재개합니다.

DOM과 CSSOM 생성이 종료되먄 이 둘을 결합하여 렌더 트리를 새성합니다.
렌더트리는 head에 있는 노드, css에 의해 display:none과 같이 화면에 렌더링되지 않는 노드들은 포함하지 않습니다.

이 렌더트리의 정보를 기준으로 layout이 진행됩니다. Layout에서는 모든 노드들의 위치와 크기 등이 계산되고,
이후 paint과정을 통해 픽셀을 화면에 그려줍니다.

이 과정은 critical render path라고 합니다.
HTML 문서에 자바스크립트 요청이 있다면 파싱을 통해 AST(abstract syntax tree)가 생성되며, DOM과 CSSOM이 이 과정에서 변경되어 렌더트리에 결합될 수 있습니다. DOM이나 CSSOM이 변경되어 렌더트리에 합쳐질 떄, 노드의 위치나 크기등이 다시 계산해서 그려야 하는 과정인 reflow나, 레이아웃 이외의 변경 사항을 다시 화면에 그려줘야하는 repaint과정이 발생할 수 있습니다.
자바스크립트를 통해 노드를 추가/삭제하거나, 브라우저 창 리사이징, HTML 요소 레이아웃을 변경 시 다시 레이아웃이 되는 reflow가 발생할 수 있습니다.
이는 화면 버벅거림이나 유저 상호작용에 부정적인 경험을 줄 수 있기 때문에 주의를 해야 합니다.
```

</details>

<details>

<summary> 2. 자바스크립트의 파싱과 실행과정은 어떻게 되나요?  </summary>

```
자바스크립트 파싱과 실행은 자바스크립트 엔진에 의해 처리됩니다.
렌더링 도중 자바스크립트 스크립트 요청이 있다면 서버로부터 리소스를 요청받아,
응답으로 받은 자바스크립트 스크립트를 자바스크립트 엔진이 제어권을 넘겨받아 파싱하기 시작합니다.
먼저 토크나이징을 통해 자바스크립트 소스코드를 문법적 의미를 갖는 코드로 분해합니다.
이 토큰들을 구문 분석 (syntatic analysis)하여 AST (abstract syntax tree)를 생성합니다.
이후 AST는 인터프리터가 실행가능한 중간 코드인 바이트 코드로 변환되고 실행됩니다.
v8의 경우 히든 클래스와 터보팬을 통해 최적화를 하기도 합니다.
```

</details>

<details>

<summary> 3. 자바스크립트 스크립트를 body 끝 태그 전에 넣어야하는 이유?  </summary>

```
브라우저는 동기적으로 HTML,CSS,JS을 파싱합니다.
자바스킓트 코드나 스크립트 요청이 HTML 파싱 완료가 되기 전에 위치하게 된다면
블로킹이 발생하게 됩니다.
이렇게 DOM 생성 이전에 자바스크립트 코드가 실행되어, 예를 들어 dom api를 활용해 DOM에 접근하고자 한다면 에러가 발생할 수 있습니다.
따라서 관례적으로 body 끝 태그 전에 위치하는 게 좋습니다.
```

</details>

<details>

<summary> 4. script 태그의 async과 defer attribute의 차이? </summary>

```
script 태그에 async과 defer 키워드는 모두
HTML파싱과 외부 자바스크립트 파일의 로드가 비동기적으로 동시에 진행된다는 공통점이 있지만,
자바스크립트의 실행 시점에는 차이가 있습니다.
async의 경우 script 태그의 순서와는 무관하게 로드가 완료된 스크립트부터 먼저 실행이됩니다.
따라서 async는 순서대로 실행되어야하는 스크립트들의 경우에는 쓰면 안됩니다.

                              ---- JS 로드 ---> --JS 실행 ->
---------HTML 파싱---------------------------->            --- DOMContentLoaded 이벤트 ---->


반면 defer의 경우 DOM생성이 완료된 직후 스크립트가 실행됩니다.

                              ---- JS 로드 ---> --JS 실행 ->
---------HTML 파싱---------------------------->

즉, async는 스크립트의 로드 완료 순서대로 실행되고, defer는 DOM 생성이 완료되고나서야 실행이 됩니다.


```

</details>

## 💭 TMI

> DNS, 3way handshake, v8 터보팬을 통한 최적화, AST 등은 좀 더 살펴봐야할 내용 같다.<br/>
> 처음에는 좀 안읽혀서 두번 읽어야했다. HTML과 CSS은 어느정도 이해됐었는데, 자바스크립트는 언제 동작하지 싶었지만, 결국 AST도 cssom처럼 dom 파싱을 블로킹하는 친구.
