# 14 전역 변수의 문제점

<details>
<summary> 1.  호이스팅은 스코프 단위로 동작한다.(🅾️ / ❎) </summary>

```
🅾️
저번 장에서 살펴봤던, 함수 레벨 스코프를 지닌 var 키워드로 선언한 변수의 예를 살펴봅시다.

var a =1;

function printBeforeAndAfter(){
    console.log(a);
    var a = 2;
    console.log(a);
}
printBeforeAndAfter();

위의 결과는 undefined과 2를 출력합니다.
변수의 호이스팅에 대해 공부했을 때,
런타임 이전에 자바스크립트는 변수의 선언부를 코드의 최상단으로 끌어올린다고 했습니다.
그렇다면 a는 1이어야 하는게 아닐까요?
이는 전역 스코프에서 선언된 식별자의 동작방식입니다.
식별자는 스코프를 지니는데, 위의 예에서는 함수 레벨 스코프입니다.

따라서 자바스크립트는 함수가 실행되면 가장 먼저 스코프가 생성될 때 함수 내부의 최상단으로 선언된 식별자들을 호이스팅합니다.
```

</details>

<details>
<summary> 2. 전역 변수의 문제점 4가지? </summary>

```
전역 변수는 암묵적 결합(implicit coupling),
긴 생명 주기,
스코프 체인 상에서 종점에 존재한다는 점,
그리고 네임스페이스를 오염할 수 있다는 문제점을 지니고 있습니다.

전역 변수가 어디에서든 참조가 가능하므로, 의도치 않은 재할당, 재선언, 값 변경이 발생할 가능성도 높아집니다.
또한, 메모리 리소스를 차지하고 있는 시간도 길어져 값 변경에 따른 문제를 일으킬 시간도 그만큼 늘어납니다.
전역 변수는 스코프의 최상단, 즉 스코프 체인의 맨 끝에 있으므로, 검색의 속도가 느려집니다.
마지막으로 파일이 분리되어도, 스코프는 공유하는 문제 때문에, 변수나 함수명이 중첩될 가능성이 높아져 오류를 일으킬 수 있습니다.
```

</details>

<details>
<summary> 3. 전역 변수의 사용 억제하는 방법? </summary>

```
전역 변수의 긴 생명 주기, 네임스페이스 오염, 암묵적 결합 등의 문제는 의도치 않은 값 변경, 메모리 낭비, 코드의 혼란을 일으킬 수 있다는 점에서 무분별한 사용을 지양해야 합니다.

전역 변수의 사용 억제 방법에는 즉시 실행 함수 사용, 모듈 패턴 활용, ES6 모듈 활용 등이 있습니다.

즉시 실행 함수는 선언과 동시에 한번만 호출이 가능하므로, 함수 레벨의 스코프가 생깁니다.
따라서 이 함수 내부에서 선언된 변수는 해당 함수의 지역 변수가 됩니다.

모듈 패턴은 부분적으로 객체의 프로퍼티를 감추는 정보 은닉화를 부분적으로 활용한 전역변수의 사용을 억제하는 방법입니다.

var Counter= (function(){
    var num = 0;
    return {
        increase(){
            return ++num;
        },
        decrease(){
            return --num;
        }

    }
}());

// console.log(Counter.num); //undefined
// console.log(Counter.increase()); //1
// console.log(Counter.increase()); //2
// console.log(Counter.decrease()); //1

위의 코드에서 Counter 즉시 실행 함수가 할당되어 있습니다.
지역 변수로 num이 있고, 메서드 increase와 decrease를 지닌 객체를 반환합니다.
여기서, 클로저의 개념이 쓰이고 있는데, num이 선언된 즉시 실행 함수의 스코프는 함수 실행이 종료되면 메모리 회수를 해야하지만,
리턴 값의 메소드가 이를 참조하고 있기 때문에 메모리 해제하지 않습니다.

객체의 변수인 num은 private member, 리턴한 객체는 public member가 됩니다.

마지막으로, ES6의 모듈은 script에 type="module"을 추가하면
파일에 독자적인 모듈 스코프를 제공합니다. 따라서 var로 선언한 변수들이 전역 변수가 되는 문제를 피할 수 있습니다.
```

</details>

## 💭 TMI

> 가장 쉬운 전역 변수 사용 억제 방법은 var 키워드를 사용 안하면 되지 않나 + 변수 선언 자체를 필요 시에만 하기? <br/> `type="module"`은 리액트나 넥스트 프로젝트 할 때 package.json에 종종 넣었었는데 관련 있는 거였나? ➡️ [Using ES modules in Node.js](https://blog.logrocket.com/es-modules-in-node-today/)에 의하면 ES 모듈로 쓰이기 위해 쓰인다고 한다.
